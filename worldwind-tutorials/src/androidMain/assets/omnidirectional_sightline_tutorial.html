<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Surface Image Tutorial</title>
    <script src="file:///android_asset/codemirror-5.65.3/lib/codemirror.js" type="text/javascript"></script>
    <script src="file:///android_asset/codemirror-5.65.3/mode/mode.js" type="text/javascript"></script>
    <script src="file:///android_asset/codemirror-5.65.3/mode/kotlin/kotlin.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="file:///android_asset/codemirror-5.65.3/lib/codemirror.css"/>
    <link rel="stylesheet" type="text/css" href="file:///android_asset/override.css"/>
</head>
<body>
<h1>Line Of Sight Tutorial</h1>
<p>
    Demonstrates how to create an OmnidirectionalSightline and add it to the globe to visualize line of sight. An
    OmnidirectionalSightline provides a visual area representation of line of sight from a provided origin. Areas
    occluded by terrain from line of sight will appear in a different color than areas visible to the provided point.
</p>
<p>
    This tutorial demonstrates the creation of an OmnidirectionSightline. In addition to the OmnidirectionalSightline, a
    Placemark indicating the position of the sightline origin is added to provide visual context.
</p>
<p>
    The regions colored green indicate they are visible from the position provided to the OmnidirectionSightline.
    Regions colored gray are occluded by terrain. This tutorial uses a sightline range of 10,000 meters.
</p>
<h2>Example</h2>
<h3>OmnidirectionalSightlineFragment.kt</h3>
<p>
    The OmnidirectionSightlineFragment class extends the BasicGlobeFragment and overrides the createWorldWindow method.
    An OmnidirectionalSightline object with specified position and range is then created and added to the globe.
</p>
<div style="border-top: 1px solid black; border-bottom: 1px solid black;">
    <textarea id="kotlin-code">
open class OmnidirectionalSightlineFragment: BasicGlobeFragment() {
    /**
     * Creates a new WorldWindow (GLSurfaceView) object with an OmnidirectionalSightline
     *
     * @return The WorldWindow object containing the globe.
     */
    override fun createWorldWindow(): WorldWindow {
        // Let the super class (BasicGlobeFragment) do the creation
        val wwd = super.createWorldWindow()

        // Add omnidirectional sight line Layer
        wwd.engine.layers.addLayer(buildSightLineLayer())

        // Position the camera to look at the line of site terrain coverage
        val lookAt = LookAt().setDegrees(
            latitudeDegrees = 46.230,
            longitudeDegrees = -122.190,
            altitudeMeters = 500.0,
            altitudeMode = AltitudeMode.ABSOLUTE,
            rangeMeters = 1.5e4,
            headingDegrees = 45.0,
            tiltDegrees = 70.0,
            rollDegrees = 0.0
        )
        wwd.engine.cameraFromLookAt(lookAt)
        return wwd
    }
}

/**
 * Create a layer with the example sightline
 */
fun buildSightLineLayer(): RenderableLayer {
    val layer = RenderableLayer("Sightline")

    // Specify the sightline position, which is the origin of the line of sight calculation
    val position = Position.fromDegrees(46.230, -122.190, 2500.0)
    // Specify the range of the sightline (meters)
    val range = 10000.0
    // Create attributes for the visible terrain
    val visibleAttributes = ShapeAttributes().apply { interiorColor = Color(0f, 1f, 0f, 0.5f) }
    // Create attributes for the occluded terrain
    val occludedAttributes = ShapeAttributes().apply { interiorColor = Color(0.1f, 0.1f, 0.1f, 0.8f) }
    // Create the sightline
    val sightline = OmnidirectionalSightline(position, range).apply {
        // Set the attributes
        attributes = visibleAttributes
        occludeAttributes = occludedAttributes
    }
    // Add sightline to a layer
    layer.addRenderable(sightline)
    // Create a Placemark to visualize the position of the sightline
    val placemark = Placemark(position)
    placemark.attributes.apply {
        imageSource = ImageSource.fromResource(MR.images.aircraft_fixwing)
        imageScale = 2.0
        isDrawLeader = true
    }
    layer.addRenderable(placemark)

    return layer
}
    </textarea>
</div>

<script type="text/javascript">
      var javaEditor = CodeMirror.fromTextArea(document.getElementById("kotlin-code"), {
        lineNumbers: true,
        matchBrackets: true,
        mode: "google-kotlin",
        readOnly: true
      });
</script>
</body>
</html>
